2024-11-14 12:59:14.509366: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
当前脚本的文件名是: TrainLSTM_F4.py
2024-11-14 12:59:16.070890: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX512F
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2024-11-14 12:59:16.078919: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-14 12:59:16.079911: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcuda.so.1
2024-11-14 12:59:16.098296: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-14 12:59:16.098335: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-14 12:59:16.101302: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-14 12:59:16.101386: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-14 12:59:16.102606: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-14 12:59:16.102922: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-14 12:59:16.106074: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-14 12:59:16.106794: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-14 12:59:16.107086: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-14 12:59:16.107513: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-14 12:59:16.107547: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-14 12:59:16.716747: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-14 12:59:16.716804: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-14 12:59:16.716814: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-14 12:59:16.717962: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 22422 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:b1:00.0, compute capability: 8.6)
BETA = 0.999, GAMMA = 2
init data completed!
2024-11-14 13:00:02.209334: I tensorflow/compiler/jit/xla_cpu_device.cc:41] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-14 13:00:02.210395: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-14 13:00:02.210448: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-14 13:00:02.210547: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-14 13:00:02.210570: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-14 13:00:02.210598: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-14 13:00:02.210636: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-14 13:00:02.210661: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-14 13:00:02.210690: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-14 13:00:02.210710: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-14 13:00:02.211096: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-14 13:00:02.211412: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-14 13:00:02.211691: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-14 13:00:02.211717: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-14 13:00:02.211743: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-14 13:00:02.211758: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-14 13:00:02.211773: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-14 13:00:02.211787: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-14 13:00:02.211803: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-14 13:00:02.211818: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-14 13:00:02.211833: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-14 13:00:02.212151: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-14 13:00:02.212272: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-14 13:00:02.212283: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-14 13:00:02.212291: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-14 13:00:02.212737: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 22422 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:b1:00.0, compute capability: 8.6)
WARNING:tensorflow:Layer lstm will not use cuDNN kernel since it doesn't meet the cuDNN kernel criteria. It will use generic GPU kernel as fallback when running on GPU
2024-11-14 13:00:02.375978: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-14 13:00:02.376377: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-14 13:00:02.376409: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-14 13:00:02.376443: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-14 13:00:02.376456: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-14 13:00:02.376478: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-14 13:00:02.376491: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-14 13:00:02.376504: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-14 13:00:02.376517: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-14 13:00:02.376530: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-14 13:00:02.376828: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-14 13:00:02.376859: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-14 13:00:02.376868: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-14 13:00:02.376876: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-14 13:00:02.377201: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 22422 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:b1:00.0, compute capability: 8.6)
2024-11-14 13:00:02.625488: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:196] None of the MLIR optimization passes are enabled (registered 0 passes)
2024-11-14 13:00:02.647872: I tensorflow/core/platform/profile_utils/cpu_utils.cc:112] CPU Frequency: 2100000000 Hz
2024-11-14 13:00:02.928353: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-14 13:00:03.555546: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-14 13:00:03.562902: I tensorflow/stream_executor/cuda/cuda_blas.cc:1838] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
Macro-F1: 0.21461302186615416
Micro-F1: 0.8068454244224221
Epoch 1 completed, average loss: 15.981788450472017, duration: 1897.42 seconds
Macro-F1: 0.28952653944186296
Micro-F1: 0.8171830383728566
Epoch 2 completed, average loss: 9.114714028898222, duration: 1910.66 seconds
Macro-F1: 0.35625026951390976
Micro-F1: 0.840354868756585
Epoch 3 completed, average loss: 7.321264424381967, duration: 1987.80 seconds
Macro-F1: 0.428818488402544
Micro-F1: 0.8615569026859473
Epoch 4 completed, average loss: 6.126555210833875, duration: 1810.97 seconds
Epoch 4, Intersection size: 3
Macro-F1: 0.5251402785677786
Micro-F1: 0.887660523141291
Epoch 5 completed, average loss: 5.342062935451608, duration: 1911.53 seconds
Epoch 5, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 70 62]
Macro-F1: 0.5654035675494364
Micro-F1: 0.8958527386278612
Epoch 6 completed, average loss: 4.77664594871008, duration: 1988.38 seconds
Epoch 6, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 70 62]
Macro-F1: 0.6228492559478197
Micro-F1: 0.9036479408755669
Epoch 7 completed, average loss: 4.316631035595995, duration: 1988.07 seconds
Epoch 7, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 70 62]
Macro-F1: 0.6138258307762322
Micro-F1: 0.908717494541068
Epoch 8 completed, average loss: 3.940778471682428, duration: 1870.04 seconds
Epoch 8, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 70 62]
Macro-F1: 0.6296715237140946
Micro-F1: 0.9139397456061323
Epoch 9 completed, average loss: 3.664438976820014, duration: 1951.38 seconds
Epoch 9, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 70 62]
Macro-F1: 0.6573811775230316
Micro-F1: 0.9161004138099528
Epoch 10 completed, average loss: 3.4293203856788224, duration: 1869.38 seconds
Epoch 10, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.6704972239065686
Micro-F1: 0.9173525324863717
Epoch 11 completed, average loss: 3.1846328427664745, duration: 1976.32 seconds
Epoch 11, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.6870605708179484
Micro-F1: 0.9206049870970697
Epoch 12 completed, average loss: 2.970182413055051, duration: 1953.44 seconds
Epoch 12, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.6967860872780709
Micro-F1: 0.9249950373345142
Epoch 13 completed, average loss: 2.80654007463611, duration: 1959.27 seconds
Epoch 13, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7052493725669083
Micro-F1: 0.9269342943089679
Epoch 14 completed, average loss: 2.727133423601877, duration: 1997.81 seconds
Epoch 14, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7109241859021396
Micro-F1: 0.9292018506924827
Epoch 15 completed, average loss: 2.65161786443477, duration: 1913.91 seconds
Epoch 15, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7199168935656206
Micro-F1: 0.9315762952556917
Epoch 16 completed, average loss: 2.514747890034729, duration: 1937.59 seconds
Epoch 16, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7220501755424871
Micro-F1: 0.9330040159416085
Epoch 17 completed, average loss: 2.4094030660692995, duration: 2068.62 seconds
Epoch 17, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7290994677956836
Micro-F1: 0.9347142268167173
Epoch 18 completed, average loss: 2.2971410594153316, duration: 1910.84 seconds
Epoch 18, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7326156858977817
Micro-F1: 0.9357296645238131
Epoch 19 completed, average loss: 2.222706562437969, duration: 1874.33 seconds
Epoch 19, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7354606571634933
Micro-F1: 0.9374017010490311
Epoch 20 completed, average loss: 2.1741830988388755, duration: 1944.36 seconds
Epoch 20, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7444797014399264
Micro-F1: 0.9385163920658431
Epoch 21 completed, average loss: 2.1899387370256584, duration: 1797.20 seconds
Epoch 21, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7392706342911841
Micro-F1: 0.9401044450213013
Epoch 22 completed, average loss: 2.072733821257618, duration: 1843.73 seconds
Epoch 22, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.743164083738325
Micro-F1: 0.9410511688985936
Epoch 23 completed, average loss: 2.062395854429765, duration: 1937.17 seconds
Epoch 23, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7581639098640132
Micro-F1: 0.9420666066056895
Epoch 24 completed, average loss: 2.0469669797927903, duration: 1979.42 seconds
Epoch 24, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7472451171391284
Micro-F1: 0.9428606330834186
Epoch 25 completed, average loss: 1.9030528955245847, duration: 1935.45 seconds
Epoch 25, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7521726234036213
Micro-F1: 0.9431431232726106
Epoch 26 completed, average loss: 1.8788737867185148, duration: 1918.09 seconds
Epoch 26, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7592229785580229
Micro-F1: 0.943669929301104
Epoch 27 completed, average loss: 1.8295564941272209, duration: 1889.83 seconds
Epoch 27, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7760116513549872
Micro-F1: 0.9454870283559071
Epoch 28 completed, average loss: 1.7898141638749205, duration: 2016.56 seconds
Epoch 28, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7730396510863621
Micro-F1: 0.9420818763456459
Epoch 29 completed, average loss: 1.7391489948320449, duration: 1887.51 seconds
Epoch 29, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
Macro-F1: 0.7751405329509183
Micro-F1: 0.944784620317916
Epoch 30 completed, average loss: 1.8704070727671347, duration: 1850.90 seconds
Epoch 30, Intersection size: 4
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 4 top_k_indices [55 54 62 70]
TSMRecord—100 [3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4]
loss_history—100 [15.981788450472017, 9.114714028898222, 7.321264424381967, 6.126555210833875, 5.342062935451608, 4.77664594871008, 4.316631035595995, 3.940778471682428, 3.664438976820014, 3.4293203856788224, 3.1846328427664745, 2.970182413055051, 2.80654007463611, 2.727133423601877, 2.65161786443477, 2.514747890034729, 2.4094030660692995, 2.2971410594153316, 2.222706562437969, 2.1741830988388755, 2.1899387370256584, 2.072733821257618, 2.062395854429765, 2.0469669797927903, 1.9030528955245847, 1.8788737867185148, 1.8295564941272209, 1.7898141638749205, 1.7391489948320449, 1.8704070727671347]
Total training time: 57779.44 seconds
scaling_factor_value： [[1.0542353e+00 1.2622081e-04 8.5483885e-01 9.4857323e-01 1.1241772e+00
  2.0984873e-01 9.4192481e-01 1.0049306e+00 8.9402264e-01 8.9093703e-01
  2.5763163e-01 7.1663314e-01 8.5598433e-01 1.3111383e+00 1.2560999e+00
  1.1724141e+00 1.2142603e+00 1.0375080e+00 1.0223157e+00 1.1416202e+00
  1.3009254e+00 8.0015308e-01 7.3881000e-01 7.1147609e-01 8.5532379e-01
  8.5615128e-01 1.3641250e+00 1.2211313e+00 8.8009441e-01 8.9210880e-01
  8.7241542e-01 1.2623023e+00 8.4703147e-01 7.5506389e-01 7.9577464e-01
  1.2412949e+00 1.2381569e+00 8.2196063e-01 8.3484715e-01 5.4722250e-01
  1.0806533e+00 1.0958539e+00 1.1443759e+00 1.0191149e+00 8.4633833e-01
  1.0143560e+00 9.4859630e-01 8.3430582e-01 9.4870186e-01 1.1256604e+00
  1.1807313e+00 3.8053671e-01 1.5442370e+00 1.0701187e+00 2.2710478e+00
  3.1994293e+00 1.4601644e+00 9.2148679e-01 9.6268600e-01 1.6448414e-05
  1.1498357e+00 1.1896275e+00 2.1571794e+00 1.6448414e-05 5.6448436e-01
  1.6448414e-05 1.0344428e+00 1.1109440e+00 1.0685661e+00 1.4806726e+00
  1.8840630e+00 1.7085626e+00]]
start testing...
sorted_indices： [55 54 62 70 71 52 69 56 26 13 20 31 14 35 36 27 16 61 50 15 60 42 19 49
  4 67 41 40 53 68  0 17 66 18 43 45  7 58 48 46  3  6 57  8 29  9 28 30
 25 12 24  2 32 44 38 47 37 21 34 33 22 11 23 64 39 51 10  5  1 65 59 63]
Macro-F1: 0.7751405329509183
Micro-F1: 0.944784620317916
loss_history [15.981788450472017, 9.114714028898222, 7.321264424381967, 6.126555210833875, 5.342062935451608, 4.77664594871008, 4.316631035595995, 3.940778471682428, 3.664438976820014, 3.4293203856788224, 3.1846328427664745, 2.970182413055051, 2.80654007463611, 2.727133423601877, 2.65161786443477, 2.514747890034729, 2.4094030660692995, 2.2971410594153316, 2.222706562437969, 2.1741830988388755, 2.1899387370256584, 2.072733821257618, 2.062395854429765, 2.0469669797927903, 1.9030528955245847, 1.8788737867185148, 1.8295564941272209, 1.7898141638749205, 1.7391489948320449, 1.8704070727671347]
macro_F1List [0.21461302186615416, 0.28952653944186296, 0.35625026951390976, 0.428818488402544, 0.5251402785677786, 0.5654035675494364, 0.6228492559478197, 0.6138258307762322, 0.6296715237140946, 0.6573811775230316, 0.6704972239065686, 0.6870605708179484, 0.6967860872780709, 0.7052493725669083, 0.7109241859021396, 0.7199168935656206, 0.7220501755424871, 0.7290994677956836, 0.7326156858977817, 0.7354606571634933, 0.7444797014399264, 0.7392706342911841, 0.743164083738325, 0.7581639098640132, 0.7472451171391284, 0.7521726234036213, 0.7592229785580229, 0.7760116513549872, 0.7730396510863621, 0.7751405329509183]
micro_F1List [0.8068454244224221, 0.8171830383728566, 0.840354868756585, 0.8615569026859473, 0.887660523141291, 0.8958527386278612, 0.9036479408755669, 0.908717494541068, 0.9139397456061323, 0.9161004138099528, 0.9173525324863717, 0.9206049870970697, 0.9249950373345142, 0.9269342943089679, 0.9292018506924827, 0.9315762952556917, 0.9330040159416085, 0.9347142268167173, 0.9357296645238131, 0.9374017010490311, 0.9385163920658431, 0.9401044450213013, 0.9410511688985936, 0.9420666066056895, 0.9428606330834186, 0.9431431232726106, 0.943669929301104, 0.9454870283559071, 0.9420818763456459, 0.944784620317916]
starting retraining
K= 4 top_k_indices [55 54 62 70]
BETA = 0.999, GAMMA = 2
init data completed!
WARNING:tensorflow:Layer lstm_1 will not use cuDNN kernel since it doesn't meet the cuDNN kernel criteria. It will use generic GPU kernel as fallback when running on GPU
2024-11-15 05:32:17.332104: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-15 05:32:17.332636: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-15 05:32:17.332680: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-15 05:32:17.332741: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-15 05:32:17.332758: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-15 05:32:17.332776: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-15 05:32:17.332794: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-15 05:32:17.332811: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-15 05:32:17.332829: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-15 05:32:17.332845: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-15 05:32:17.333156: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-15 05:32:17.333203: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-15 05:32:17.333214: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-15 05:32:17.333221: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-15 05:32:17.333556: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 22422 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:b1:00.0, compute capability: 8.6)
start retraining...
Macro-F1: 0.10597340034974546
Micro-F1: 0.5500007634869978
Epoch 1 completed, average loss: 21.47392215377175, duration: 462.90 seconds
Macro-F1: 0.13932779222775252
Micro-F1: 0.622837423078685
Epoch 2 completed, average loss: 15.466534148113569, duration: 465.91 seconds
Macro-F1: 0.14841824385945243
Micro-F1: 0.6248759333628549
Epoch 3 completed, average loss: 14.319675349270293, duration: 453.49 seconds
Macro-F1: 0.19114555120576748
Micro-F1: 0.6492006291132862
Epoch 4 completed, average loss: 13.396077176243079, duration: 456.07 seconds
Macro-F1: 0.24062036472805906
Micro-F1: 0.6553161599657957
Epoch 5 completed, average loss: 12.5203828825629, duration: 466.59 seconds
Macro-F1: 0.24585947671259198
Micro-F1: 0.662996839163829
Epoch 6 completed, average loss: 11.913426096987715, duration: 458.89 seconds
Macro-F1: 0.2516502560633217
Micro-F1: 0.6650658889279115
Epoch 7 completed, average loss: 11.481663088245176, duration: 480.39 seconds
Macro-F1: 0.25823045587310245
Micro-F1: 0.6662263891645925
Epoch 8 completed, average loss: 11.14985905165047, duration: 467.08 seconds
Macro-F1: 0.26823870297673547
Micro-F1: 0.66973079448457
Epoch 9 completed, average loss: 10.878380950045576, duration: 456.31 seconds
Macro-F1: 0.28942207050427454
Micro-F1: 0.6730672326650277
Epoch 10 completed, average loss: 10.642127549043998, duration: 473.94 seconds
Macro-F1: 0.29645919790871567
Micro-F1: 0.6744033349112064
Epoch 11 completed, average loss: 10.430504748149051, duration: 452.72 seconds
Macro-F1: 0.30747428670323884
Micro-F1: 0.6757012628074944
Epoch 12 completed, average loss: 10.241292931716913, duration: 466.75 seconds
Macro-F1: 0.31354199820881135
Micro-F1: 0.6618668784070607
Epoch 13 completed, average loss: 10.074937548155958, duration: 464.82 seconds
Macro-F1: 0.3340139028597269
Micro-F1: 0.6624700331353357
Epoch 14 completed, average loss: 9.930447448383678, duration: 463.25 seconds
Macro-F1: 0.33897580773980723
Micro-F1: 0.6627525233245278
Epoch 15 completed, average loss: 9.80451089046368, duration: 471.28 seconds
Macro-F1: 0.34481696618944313
Micro-F1: 0.6635847241521476
Epoch 16 completed, average loss: 9.692512104488289, duration: 456.22 seconds
Macro-F1: 0.3480613523913066
Micro-F1: 0.6647833987387195
Epoch 17 completed, average loss: 9.591115463713896, duration: 464.17 seconds
Macro-F1: 0.35135740974926444
Micro-F1: 0.6663714516941777
Epoch 18 completed, average loss: 9.498249774304803, duration: 462.38 seconds
Macro-F1: 0.35419049899144683
Micro-F1: 0.6666921162332605
Epoch 19 completed, average loss: 9.411983583879412, duration: 467.17 seconds
Macro-F1: 0.3606332533759633
Micro-F1: 0.6697995083143734
Epoch 20 completed, average loss: 9.33130799650297, duration: 467.84 seconds
Macro-F1: 0.3662841188575482
Micro-F1: 0.6702957748629541
Epoch 21 completed, average loss: 9.255242658750152, duration: 463.12 seconds
Macro-F1: 0.36779618706310163
Micro-F1: 0.6713951961398097
Epoch 22 completed, average loss: 9.183239510132271, duration: 471.21 seconds
Macro-F1: 0.36921269985962174
Micro-F1: 0.6718532883384996
Epoch 23 completed, average loss: 9.114702529371858, duration: 462.61 seconds
Macro-F1: 0.3695175250830748
Micro-F1: 0.6728381865656828
Epoch 24 completed, average loss: 9.049146014873983, duration: 457.68 seconds
Macro-F1: 0.3722237929377206
Micro-F1: 0.6898715814869673
Epoch 25 completed, average loss: 8.98627129378157, duration: 480.50 seconds
Macro-F1: 0.37234131872656084
Micro-F1: 0.6921315030005039
Epoch 26 completed, average loss: 8.925791795152874, duration: 474.64 seconds
Macro-F1: 0.3740767264420467
Micro-F1: 0.6921009635205913
Epoch 27 completed, average loss: 8.867166578295244, duration: 457.54 seconds
Macro-F1: 0.374780560428017
Micro-F1: 0.6927117531188444
Epoch 28 completed, average loss: 8.81066349304816, duration: 465.44 seconds
Macro-F1: 0.37788874506407377
Micro-F1: 0.6926659438989754
Epoch 29 completed, average loss: 8.756394554492966, duration: 456.11 seconds
Macro-F1: 0.3782140616672709
Micro-F1: 0.6923147398799798
Epoch 30 completed, average loss: 8.703795273632597, duration: 464.51 seconds
dnn2_loss_history [21.47392215377175, 15.466534148113569, 14.319675349270293, 13.396077176243079, 12.5203828825629, 11.913426096987715, 11.481663088245176, 11.14985905165047, 10.878380950045576, 10.642127549043998, 10.430504748149051, 10.241292931716913, 10.074937548155958, 9.930447448383678, 9.80451089046368, 9.692512104488289, 9.591115463713896, 9.498249774304803, 9.411983583879412, 9.33130799650297, 9.255242658750152, 9.183239510132271, 9.114702529371858, 9.049146014873983, 8.98627129378157, 8.925791795152874, 8.867166578295244, 8.81066349304816, 8.756394554492966, 8.703795273632597]
dnn2_macro_F1List [0.10597340034974546, 0.13932779222775252, 0.14841824385945243, 0.19114555120576748, 0.24062036472805906, 0.24585947671259198, 0.2516502560633217, 0.25823045587310245, 0.26823870297673547, 0.28942207050427454, 0.29645919790871567, 0.30747428670323884, 0.31354199820881135, 0.3340139028597269, 0.33897580773980723, 0.34481696618944313, 0.3480613523913066, 0.35135740974926444, 0.35419049899144683, 0.3606332533759633, 0.3662841188575482, 0.36779618706310163, 0.36921269985962174, 0.3695175250830748, 0.3722237929377206, 0.37234131872656084, 0.3740767264420467, 0.374780560428017, 0.37788874506407377, 0.3782140616672709]
dnn2_micro_F1List [0.5500007634869978, 0.622837423078685, 0.6248759333628549, 0.6492006291132862, 0.6553161599657957, 0.662996839163829, 0.6650658889279115, 0.6662263891645925, 0.66973079448457, 0.6730672326650277, 0.6744033349112064, 0.6757012628074944, 0.6618668784070607, 0.6624700331353357, 0.6627525233245278, 0.6635847241521476, 0.6647833987387195, 0.6663714516941777, 0.6666921162332605, 0.6697995083143734, 0.6702957748629541, 0.6713951961398097, 0.6718532883384996, 0.6728381865656828, 0.6898715814869673, 0.6921315030005039, 0.6921009635205913, 0.6927117531188444, 0.6926659438989754, 0.6923147398799798]
start testing...
Processed 10000 rows
Processed 20000 rows
Processed 30000 rows
Processed 40000 rows
Processed 50000 rows
Processed 60000 rows
Processed 70000 rows
Processed 80000 rows
Processed 90000 rows
Processed 100000 rows
Processed 110000 rows
Processed 120000 rows
Processed 130000 rows
0 0.7592067988668555 1072 1412
1 0.3702435312024353 973 2628
10 0.5107913669064749 71 139
11 0.9155217772581117 3132 3421
12 0.7692307692307693 10 13
13 0.9571428571428572 134 140
14 0.8823529411764706 15 17
15 0.3116883116883117 384 1232
16 0.0 0 309
17 0.0 0 400
18 0.6764705882352942 69 102
19 0.0 0 359
2 0.0 0 833
20 0.16252129471890972 477 2935
21 0.0 0 461
22 0.0 0 30
23 0.5878398889804415 13555 23059
24 0.033045854324993594 387 11711
25 0.002881844380403458 1 347
26 0.0 0 4
27 0.0 0 50
28 0.8587059787059788 52424 61050
3 0.33653846153846156 280 832
4 0.7114686040477426 1371 1927
5 0.9737431956452129 12164 12492
6 0.8573216520650814 685 799
7 0.6188235294117647 1052 1700
8 0.9568896051571314 2375 2482
9 0.5 47 94
Top-1 accuracy: 0.6923147398799798
Top-3 accuracy: 0.9428911725633312
Top-5 accuracy: 0.9813632823833011
