2024-11-14 13:00:23.479171: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
当前脚本的文件名是: TrainLSTM_F8.py
2024-11-14 13:00:25.061032: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX512F
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2024-11-14 13:00:25.069280: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-14 13:00:25.070270: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcuda.so.1
2024-11-14 13:00:25.076365: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-14 13:00:25.076395: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-14 13:00:25.079145: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-14 13:00:25.079202: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-14 13:00:25.080403: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-14 13:00:25.080684: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-14 13:00:25.083639: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-14 13:00:25.084362: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-14 13:00:25.084537: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-14 13:00:25.084911: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-14 13:00:25.084942: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-14 13:00:25.727922: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-14 13:00:25.728036: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-14 13:00:25.728046: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-14 13:00:25.729389: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 21810 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:b1:00.0, compute capability: 8.6)
BETA = 0.999, GAMMA = 2
init data completed!
2024-11-14 13:01:10.100928: I tensorflow/compiler/jit/xla_cpu_device.cc:41] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-14 13:01:10.101736: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-14 13:01:10.101777: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-14 13:01:10.101852: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-14 13:01:10.101872: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-14 13:01:10.101891: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-14 13:01:10.101919: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-14 13:01:10.101937: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-14 13:01:10.101956: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-14 13:01:10.101973: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-14 13:01:10.102279: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-14 13:01:10.102524: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-14 13:01:10.102743: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-14 13:01:10.102764: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-14 13:01:10.102790: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-14 13:01:10.102802: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-14 13:01:10.102814: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-14 13:01:10.102826: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-14 13:01:10.102838: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-14 13:01:10.102850: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-14 13:01:10.102862: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-14 13:01:10.103186: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-14 13:01:10.103242: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-14 13:01:10.103253: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-14 13:01:10.103261: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-14 13:01:10.103603: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 21810 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:b1:00.0, compute capability: 8.6)
WARNING:tensorflow:Layer lstm will not use cuDNN kernel since it doesn't meet the cuDNN kernel criteria. It will use generic GPU kernel as fallback when running on GPU
2024-11-14 13:01:10.263113: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-14 13:01:10.263461: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-14 13:01:10.263491: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-14 13:01:10.263521: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-14 13:01:10.263535: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-14 13:01:10.263558: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-14 13:01:10.263572: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-14 13:01:10.263585: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-14 13:01:10.263598: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-14 13:01:10.263612: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-14 13:01:10.263914: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-14 13:01:10.263944: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-14 13:01:10.263954: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-14 13:01:10.263961: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-14 13:01:10.264276: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 21810 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:b1:00.0, compute capability: 8.6)
2024-11-14 13:01:10.503971: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:196] None of the MLIR optimization passes are enabled (registered 0 passes)
2024-11-14 13:01:10.526271: I tensorflow/core/platform/profile_utils/cpu_utils.cc:112] CPU Frequency: 2100000000 Hz
2024-11-14 13:01:10.773225: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-14 13:01:11.516483: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-14 13:01:11.521167: I tensorflow/stream_executor/cuda/cuda_blas.cc:1838] TensorFloat-32 will be used for the matrix multiplication. This will only be logged once.
Macro-F1: 0.2002543338681168
Micro-F1: 0.8039365389607415
Epoch 1 completed, average loss: 15.91902568822732, duration: 1791.84 seconds
Macro-F1: 0.3084222315109193
Micro-F1: 0.8304829818748187
Epoch 2 completed, average loss: 9.314304468968347, duration: 1926.96 seconds
Macro-F1: 0.36013662352664205
Micro-F1: 0.8478523110751424
Epoch 3 completed, average loss: 7.4485883014592655, duration: 1857.60 seconds
Macro-F1: 0.4560071829744671
Micro-F1: 0.8711310296385653
Epoch 4 completed, average loss: 6.200281992885524, duration: 1910.51 seconds
Epoch 4, Intersection size: 7
Macro-F1: 0.48826549388464674
Micro-F1: 0.8823008444166196
Epoch 5 completed, average loss: 5.424516309141663, duration: 1911.63 seconds
Epoch 5, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 70 62 71 52 31 17]
Macro-F1: 0.5388458588078546
Micro-F1: 0.8926689978469666
Epoch 6 completed, average loss: 4.916913506122728, duration: 1880.12 seconds
Epoch 6, Intersection size: 7
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 70 62 71 52 31 50]
Macro-F1: 0.5591462301169989
Micro-F1: 0.8986012918200003
Epoch 7 completed, average loss: 4.625448493663866, duration: 1754.80 seconds
Epoch 7, Intersection size: 7
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 70 62 71 52 31 50]
Macro-F1: 0.5897194401331897
Micro-F1: 0.9014720029317901
Epoch 8 completed, average loss: 4.215820518307073, duration: 1892.61 seconds
Epoch 8, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 70 62 71 52 31 50]
Macro-F1: 0.6020035964806201
Micro-F1: 0.9034417993861564
Epoch 9 completed, average loss: 3.935925989082082, duration: 1920.71 seconds
Epoch 9, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 70 62 71 52 31 50]
Macro-F1: 0.6150676269964125
Micro-F1: 0.9050222174716365
Epoch 10 completed, average loss: 3.693168133959193, duration: 1865.04 seconds
Epoch 10, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 70 62 71 52 31 50]
Macro-F1: 0.624215532970101
Micro-F1: 0.9070301882758937
Epoch 11 completed, average loss: 3.5052944670474626, duration: 1765.36 seconds
Epoch 11, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 70 62 71 52 31 50]
Macro-F1: 0.6359107435867204
Micro-F1: 0.9091679518697796
Epoch 12 completed, average loss: 3.3229421849874057, duration: 1865.43 seconds
Epoch 12, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 70 62 71 52 31 50]
Macro-F1: 0.6568790766664769
Micro-F1: 0.9116874589625739
Epoch 13 completed, average loss: 3.152016538628785, duration: 1747.99 seconds
Epoch 13, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 70 62 71 52 31 50]
Macro-F1: 0.6653376372680897
Micro-F1: 0.9141687917054773
Epoch 14 completed, average loss: 2.948022687515056, duration: 1796.99 seconds
Epoch 14, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 70 62 71 52 31 50]
Macro-F1: 0.6713754063111598
Micro-F1: 0.9159935256302585
Epoch 15 completed, average loss: 2.7873329061267262, duration: 1779.95 seconds
Epoch 15, Intersection size: 7
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 70 62 71 52 31 56]
Macro-F1: 0.6819025487029561
Micro-F1: 0.9192841545908473
Epoch 16 completed, average loss: 2.6658330347481063, duration: 1792.11 seconds
Epoch 16, Intersection size: 7
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 31 56]
Macro-F1: 0.6917020472010766
Micro-F1: 0.9223762769320039
Epoch 17 completed, average loss: 2.6041270951171973, duration: 1914.33 seconds
Epoch 17, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 31]
Macro-F1: 0.6989183269360598
Micro-F1: 0.9243078990364794
Epoch 18 completed, average loss: 2.4876382898774962, duration: 1944.41 seconds
Epoch 18, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 31]
Macro-F1: 0.7122531447953042
Micro-F1: 0.9270564522286185
Epoch 19 completed, average loss: 2.4037080244459665, duration: 1940.58 seconds
Epoch 19, Intersection size: 7
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 26]
Macro-F1: 0.7168620110771479
Micro-F1: 0.9302783673594038
Epoch 20 completed, average loss: 2.3101431527645158, duration: 1831.28 seconds
Epoch 20, Intersection size: 7
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 26]
Macro-F1: 0.7221010131130906
Micro-F1: 0.932607002702744
Epoch 21 completed, average loss: 2.240783200935185, duration: 1847.59 seconds
Epoch 21, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 26]
Macro-F1: 0.7439192532292453
Micro-F1: 0.9395547343828735
Epoch 22 completed, average loss: 2.264013029026296, duration: 1865.26 seconds
Epoch 22, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 26]
Macro-F1: 0.7258148836552529
Micro-F1: 0.9400204614515415
Epoch 23 completed, average loss: 2.1748362419292624, duration: 1921.49 seconds
Epoch 23, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 26]
Macro-F1: 0.7400046122038832
Micro-F1: 0.9401884285910611
Epoch 24 completed, average loss: 2.0323024595013512, duration: 1952.81 seconds
Epoch 24, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 26]
Macro-F1: 0.7485061593047466
Micro-F1: 0.943624120081235
Epoch 25 completed, average loss: 2.063381780315055, duration: 1890.74 seconds
Epoch 25, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 26]
Macro-F1: 0.7455869621050343
Micro-F1: 0.9437386431309075
Epoch 26 completed, average loss: 2.006486677916219, duration: 1880.11 seconds
Epoch 26, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 26]
Macro-F1: 0.7577689442621245
Micro-F1: 0.9443876070790514
Epoch 27 completed, average loss: 1.8998468020594566, duration: 1908.50 seconds
Epoch 27, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 26]
Macro-F1: 0.7550432971485044
Micro-F1: 0.9467925911221732
Epoch 28 completed, average loss: 1.9036974437850063, duration: 1795.04 seconds
Epoch 28, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 26]
Macro-F1: 0.7586062814008657
Micro-F1: 0.9472277787109286
Epoch 29 completed, average loss: 1.8283830445882512, duration: 1825.25 seconds
Epoch 29, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 26]
Macro-F1: 0.7541894033169784
Micro-F1: 0.9469376536517583
Epoch 30 completed, average loss: 1.725959474040616, duration: 1918.90 seconds
Epoch 30, Intersection size: 8
Early stopping condition met.
model.earlyStop == True 看top K factor
K= 8 top_k_indices [55 54 62 70 71 52 56 26]
TSMRecord—100 [7, 8, 7, 7, 8, 8, 8, 8, 8, 8, 8, 7, 7, 8, 8, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8]
loss_history—100 [15.91902568822732, 9.314304468968347, 7.4485883014592655, 6.200281992885524, 5.424516309141663, 4.916913506122728, 4.625448493663866, 4.215820518307073, 3.935925989082082, 3.693168133959193, 3.5052944670474626, 3.3229421849874057, 3.152016538628785, 2.948022687515056, 2.7873329061267262, 2.6658330347481063, 2.6041270951171973, 2.4876382898774962, 2.4037080244459665, 2.3101431527645158, 2.240783200935185, 2.264013029026296, 2.1748362419292624, 2.0323024595013512, 2.063381780315055, 2.006486677916219, 1.8998468020594566, 1.9036974437850063, 1.8283830445882512, 1.725959474040616]
Total training time: 55897.39 seconds
scaling_factor_value： [[1.0336841e+00 2.2408703e-06 8.7235761e-01 9.0111399e-01 9.7562695e-01
  2.5327271e-01 8.7380272e-01 9.0852845e-01 8.3746147e-01 8.7322748e-01
  1.8010855e-01 5.7413119e-01 8.5956913e-01 1.3259621e+00 1.2899157e+00
  1.3500032e+00 1.2405773e+00 9.8575205e-01 9.6550369e-01 1.1074724e+00
  1.2510182e+00 8.1456876e-01 7.1712106e-01 7.1765989e-01 8.8077080e-01
  9.5640135e-01 1.4083524e+00 1.2277304e+00 8.8070685e-01 8.6950892e-01
  8.4995276e-01 1.3045400e+00 8.3577096e-01 7.1527988e-01 7.6353908e-01
  1.2866123e+00 1.2838361e+00 1.0240144e+00 9.5649421e-01 5.7260376e-01
  1.0711151e+00 1.0949886e+00 1.1629620e+00 9.9890363e-01 8.2542169e-01
  1.0459416e+00 9.5588028e-01 7.0570815e-01 9.8100394e-01 1.1926028e+00
  1.2219648e+00 4.2081252e-01 1.5974302e+00 1.1046072e+00 2.2331078e+00
  3.1514537e+00 1.4609892e+00 9.1129911e-01 9.2020279e-01 1.6448414e-05
  1.0679241e+00 1.1228046e+00 2.1229792e+00 1.6448414e-05 4.4291288e-01
  1.6448414e-05 1.0920765e+00 1.0712253e+00 1.0811228e+00 1.3106004e+00
  1.9507970e+00 1.7791764e+00]]
start testing...
sorted_indices： [55 54 62 70 71 52 56 26 15 13 69 31 14 35 36 20 16 27 50 49 42 61 19 53
 41 66 68 67 40 60 45  0 37 43 17 48  4 18 38 25 46 58 57  7  3 24 28  6
  9  2 29 12 30  8 32 44 21 34 23 22 33 47 11 39 64 51  5 10 63 59 65  1]
Macro-F1: 0.7541894033169784
Micro-F1: 0.9469376536517583
loss_history [15.91902568822732, 9.314304468968347, 7.4485883014592655, 6.200281992885524, 5.424516309141663, 4.916913506122728, 4.625448493663866, 4.215820518307073, 3.935925989082082, 3.693168133959193, 3.5052944670474626, 3.3229421849874057, 3.152016538628785, 2.948022687515056, 2.7873329061267262, 2.6658330347481063, 2.6041270951171973, 2.4876382898774962, 2.4037080244459665, 2.3101431527645158, 2.240783200935185, 2.264013029026296, 2.1748362419292624, 2.0323024595013512, 2.063381780315055, 2.006486677916219, 1.8998468020594566, 1.9036974437850063, 1.8283830445882512, 1.725959474040616]
macro_F1List [0.2002543338681168, 0.3084222315109193, 0.36013662352664205, 0.4560071829744671, 0.48826549388464674, 0.5388458588078546, 0.5591462301169989, 0.5897194401331897, 0.6020035964806201, 0.6150676269964125, 0.624215532970101, 0.6359107435867204, 0.6568790766664769, 0.6653376372680897, 0.6713754063111598, 0.6819025487029561, 0.6917020472010766, 0.6989183269360598, 0.7122531447953042, 0.7168620110771479, 0.7221010131130906, 0.7439192532292453, 0.7258148836552529, 0.7400046122038832, 0.7485061593047466, 0.7455869621050343, 0.7577689442621245, 0.7550432971485044, 0.7586062814008657, 0.7541894033169784]
micro_F1List [0.8039365389607415, 0.8304829818748187, 0.8478523110751424, 0.8711310296385653, 0.8823008444166196, 0.8926689978469666, 0.8986012918200003, 0.9014720029317901, 0.9034417993861564, 0.9050222174716365, 0.9070301882758937, 0.9091679518697796, 0.9116874589625739, 0.9141687917054773, 0.9159935256302585, 0.9192841545908473, 0.9223762769320039, 0.9243078990364794, 0.9270564522286185, 0.9302783673594038, 0.932607002702744, 0.9395547343828735, 0.9400204614515415, 0.9401884285910611, 0.943624120081235, 0.9437386431309075, 0.9443876070790514, 0.9467925911221732, 0.9472277787109286, 0.9469376536517583]
starting retraining
K= 8 top_k_indices [55 54 62 70 71 52 56 26]
BETA = 0.999, GAMMA = 2
init data completed!
WARNING:tensorflow:Layer lstm_1 will not use cuDNN kernel since it doesn't meet the cuDNN kernel criteria. It will use generic GPU kernel as fallback when running on GPU
2024-11-15 05:03:35.786011: I tensorflow/compiler/jit/xla_gpu_device.cc:99] Not creating XLA devices, tf_xla_enable_xla_devices not set
2024-11-15 05:03:35.786473: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1720] Found device 0 with properties: 
pciBusID: 0000:b1:00.0 name: NVIDIA GeForce RTX 3090 computeCapability: 8.6
coreClock: 1.74GHz coreCount: 82 deviceMemorySize: 23.69GiB deviceMemoryBandwidth: 871.81GiB/s
2024-11-15 05:03:35.786509: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudart.so.11.0
2024-11-15 05:03:35.786571: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublas.so.11
2024-11-15 05:03:35.786589: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcublasLt.so.11
2024-11-15 05:03:35.786608: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcufft.so.10
2024-11-15 05:03:35.786626: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcurand.so.10
2024-11-15 05:03:35.786643: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusolver.so.10
2024-11-15 05:03:35.786660: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcusparse.so.11
2024-11-15 05:03:35.786677: I tensorflow/stream_executor/platform/default/dso_loader.cc:49] Successfully opened dynamic library libcudnn.so.8
2024-11-15 05:03:35.786996: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1862] Adding visible gpu devices: 0
2024-11-15 05:03:35.787035: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1261] Device interconnect StreamExecutor with strength 1 edge matrix:
2024-11-15 05:03:35.787044: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1267]      0 
2024-11-15 05:03:35.787052: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1280] 0:   N 
2024-11-15 05:03:35.787387: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1406] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 21810 MB memory) -> physical GPU (device: 0, name: NVIDIA GeForce RTX 3090, pci bus id: 0000:b1:00.0, compute capability: 8.6)
start retraining...
Macro-F1: 0.2093890286917158
Micro-F1: 0.812922780925041
Epoch 1 completed, average loss: 18.364042293690815, duration: 618.84 seconds
Macro-F1: 0.28884971888967875
Micro-F1: 0.8273755897937058
Epoch 2 completed, average loss: 10.102515883659487, duration: 618.30 seconds
Macro-F1: 0.3550325933619678
Micro-F1: 0.8456076593015621
Epoch 3 completed, average loss: 8.51122459977753, duration: 603.79 seconds
Macro-F1: 0.39055467299813923
Micro-F1: 0.8533952266792897
Epoch 4 completed, average loss: 7.475178660235747, duration: 625.56 seconds
Macro-F1: 0.40168862951948
Micro-F1: 0.8614576493762311
Epoch 5 completed, average loss: 6.802683983280612, duration: 616.79 seconds
Macro-F1: 0.4105140091169244
Micro-F1: 0.865168196185619
Epoch 6 completed, average loss: 6.353010009610608, duration: 619.06 seconds
Macro-F1: 0.45192386844548593
Micro-F1: 0.87106995067874
Epoch 7 completed, average loss: 6.0213488795840195, duration: 624.99 seconds
Macro-F1: 0.47499286092101345
Micro-F1: 0.8738337736108354
Epoch 8 completed, average loss: 5.738601215573899, duration: 617.85 seconds
Macro-F1: 0.4991230726102085
Micro-F1: 0.8781856494983891
Epoch 9 completed, average loss: 5.4812238675358405, duration: 612.94 seconds
Macro-F1: 0.5218864999362451
Micro-F1: 0.880644077631358
Epoch 10 completed, average loss: 5.248041299581028, duration: 619.78 seconds
Macro-F1: 0.551775419573771
Micro-F1: 0.883117775504283
Epoch 11 completed, average loss: 5.043188372015903, duration: 624.34 seconds
Macro-F1: 0.5630395299931469
Micro-F1: 0.885392966757776
Epoch 12 completed, average loss: 4.861088330095464, duration: 615.18 seconds
Macro-F1: 0.5723626216262553
Micro-F1: 0.8874696513918366
Epoch 13 completed, average loss: 4.6951508533020725, duration: 620.21 seconds
Macro-F1: 0.5782492480130379
Micro-F1: 0.8890882438272076
Epoch 14 completed, average loss: 4.54146335691301, duration: 619.37 seconds
Macro-F1: 0.583092912725031
Micro-F1: 0.8903021881537357
Epoch 15 completed, average loss: 4.39887639554315, duration: 618.33 seconds
Macro-F1: 0.5857872142575494
Micro-F1: 0.8909969613217487
Epoch 16 completed, average loss: 4.267864499323829, duration: 614.95 seconds
Macro-F1: 0.5879320634796801
Micro-F1: 0.8924170471376872
Epoch 17 completed, average loss: 4.148832573019714, duration: 610.19 seconds
Macro-F1: 0.5928444071588888
Micro-F1: 0.893524103284521
Epoch 18 completed, average loss: 4.04184267273197, duration: 614.89 seconds
Macro-F1: 0.6008225956297425
Micro-F1: 0.8945548107315733
Epoch 19 completed, average loss: 3.945966103409542, duration: 620.06 seconds
Macro-F1: 0.6028530485314817
Micro-F1: 0.8951579654598483
Epoch 20 completed, average loss: 3.8587062082182775, duration: 615.88 seconds
Macro-F1: 0.608514816479149
Micro-F1: 0.8959596268075555
Epoch 21 completed, average loss: 3.7776932731851356, duration: 618.57 seconds
Macro-F1: 0.6115139402744671
Micro-F1: 0.8967841927651972
Epoch 22 completed, average loss: 3.701669145039949, duration: 606.99 seconds
Macro-F1: 0.6239540789118563
Micro-F1: 0.8981050252714197
Epoch 23 completed, average loss: 3.6295281833417756, duration: 609.80 seconds
Macro-F1: 0.6353085732653516
Micro-F1: 0.8996396341370306
Epoch 24 completed, average loss: 3.5605536526499004, duration: 592.04 seconds
Macro-F1: 0.6483802808734137
Micro-F1: 0.9006550718441265
Epoch 25 completed, average loss: 3.495074832369505, duration: 588.27 seconds
Macro-F1: 0.6452154422887896
Micro-F1: 0.9011666081326635
Epoch 26 completed, average loss: 3.433222988483843, duration: 608.83 seconds
Macro-F1: 0.6479568925611565
Micro-F1: 0.9016247003313533
Epoch 27 completed, average loss: 3.3749456023590607, duration: 567.60 seconds
Macro-F1: 0.6486016381062145
Micro-F1: 0.9026248682984929
Epoch 28 completed, average loss: 3.3202469162127937, duration: 571.09 seconds
Macro-F1: 0.650164073140375
Micro-F1: 0.90351051321596
Epoch 29 completed, average loss: 3.268813311404447, duration: 562.93 seconds
Macro-F1: 0.6519591756406203
Micro-F1: 0.9059154972590818
Epoch 30 completed, average loss: 3.220160004879872, duration: 577.06 seconds
dnn2_loss_history [18.364042293690815, 10.102515883659487, 8.51122459977753, 7.475178660235747, 6.802683983280612, 6.353010009610608, 6.0213488795840195, 5.738601215573899, 5.4812238675358405, 5.248041299581028, 5.043188372015903, 4.861088330095464, 4.6951508533020725, 4.54146335691301, 4.39887639554315, 4.267864499323829, 4.148832573019714, 4.04184267273197, 3.945966103409542, 3.8587062082182775, 3.7776932731851356, 3.701669145039949, 3.6295281833417756, 3.5605536526499004, 3.495074832369505, 3.433222988483843, 3.3749456023590607, 3.3202469162127937, 3.268813311404447, 3.220160004879872]
dnn2_macro_F1List [0.2093890286917158, 0.28884971888967875, 0.3550325933619678, 0.39055467299813923, 0.40168862951948, 0.4105140091169244, 0.45192386844548593, 0.47499286092101345, 0.4991230726102085, 0.5218864999362451, 0.551775419573771, 0.5630395299931469, 0.5723626216262553, 0.5782492480130379, 0.583092912725031, 0.5857872142575494, 0.5879320634796801, 0.5928444071588888, 0.6008225956297425, 0.6028530485314817, 0.608514816479149, 0.6115139402744671, 0.6239540789118563, 0.6353085732653516, 0.6483802808734137, 0.6452154422887896, 0.6479568925611565, 0.6486016381062145, 0.650164073140375, 0.6519591756406203]
dnn2_micro_F1List [0.812922780925041, 0.8273755897937058, 0.8456076593015621, 0.8533952266792897, 0.8614576493762311, 0.865168196185619, 0.87106995067874, 0.8738337736108354, 0.8781856494983891, 0.880644077631358, 0.883117775504283, 0.885392966757776, 0.8874696513918366, 0.8890882438272076, 0.8903021881537357, 0.8909969613217487, 0.8924170471376872, 0.893524103284521, 0.8945548107315733, 0.8951579654598483, 0.8959596268075555, 0.8967841927651972, 0.8981050252714197, 0.8996396341370306, 0.9006550718441265, 0.9011666081326635, 0.9016247003313533, 0.9026248682984929, 0.90351051321596, 0.9059154972590818]
start testing...
Processed 10000 rows
Processed 20000 rows
Processed 30000 rows
Processed 40000 rows
Processed 50000 rows
Processed 60000 rows
Processed 70000 rows
Processed 80000 rows
Processed 90000 rows
Processed 100000 rows
Processed 110000 rows
Processed 120000 rows
Processed 130000 rows
0 0.9929178470254958 1402 1412
1 0.8280060882800608 2176 2628
10 0.8561151079136691 119 139
11 0.9590762934814382 3281 3421
12 1.0 13 13
13 0.9571428571428572 134 140
14 0.8235294117647058 14 17
15 0.765422077922078 943 1232
16 0.7152103559870551 221 309
17 0.1875 75 400
18 0.7843137254901961 80 102
19 0.45125348189415043 162 359
2 0.43577430972388953 363 833
20 0.3809199318568995 1118 2935
21 0.6399132321041214 295 461
22 0.0 0 30
23 0.8652586842447635 19952 23059
24 0.8417726923405345 9858 11711
25 0.002881844380403458 1 347
26 0.0 0 4
27 0.1 5 50
28 0.962948402948403 58788 61050
3 0.6947115384615384 578 832
4 0.9320186818889465 1796 1927
5 0.989193083573487 12357 12492
6 0.9461827284105131 756 799
7 0.991764705882353 1686 1700
8 0.9661563255439162 2398 2482
9 0.8936170212765957 84 94
Top-1 accuracy: 0.9059154972590817
Top-3 accuracy: 0.9809128250545893
Top-5 accuracy: 0.9943960054360275
